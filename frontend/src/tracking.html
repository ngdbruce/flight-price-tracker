<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track your flight price monitoring requests and view price history">
    <meta name="keywords" content="flight tracking, price history, flight deals monitoring">
    <title>My Flight Tracking - Flight Price Tracker</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="styles/main.css" as="style">
    <link rel="preload" href="scripts/tracking.js" as="script">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/tracking.css">
    
    <!-- Icons and favicons -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/png" href="assets/favicon.png">
    
    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#2563eb">
    
    <!-- Chart.js for price history visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js" defer></script>
</head>
<body>
    <!-- Skip to main content link for screen readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header__content">
                <h1 class="header__title">
                    <span class="header__icon" aria-hidden="true">‚úàÔ∏è</span>
                    Flight Price Tracker
                </h1>
                <nav class="nav" role="navigation" aria-label="Main navigation">
                    <ul class="nav__list">
                        <li class="nav__item">
                            <a href="index.html" class="nav__link">Track Flight</a>
                        </li>
                        <li class="nav__item">
                            <a href="#" class="nav__link nav__link--active" aria-current="page">My Tracking</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main" role="main">
        <div class="container">
            <!-- Page Header -->
            <section class="page-header" role="banner">
                <h2 class="page-header__title">My Flight Tracking</h2>
                <p class="page-header__description">
                    Monitor your active flight price alerts and view historical price data.
                </p>
            </section>

            <!-- Chat ID Input Section -->
            <section class="chat-id-section" role="region" aria-labelledby="chat-id-title">
                <div class="card">
                    <h3 id="chat-id-title" class="card__title">Enter Your Telegram Chat ID</h3>
                    <div class="chat-id-form">
                        <div class="form-group">
                            <label for="chat-id-input" class="form-label">
                                Telegram Chat ID <span class="required" aria-label="required">*</span>
                            </label>
                            <div class="input-group">
                                <input 
                                    type="text" 
                                    id="chat-id-input" 
                                    class="form-input" 
                                    placeholder="Enter your Telegram Chat ID"
                                    pattern="^-?\d+$"
                                    required
                                    aria-describedby="chat-id-help chat-id-error"
                                >
                                <button 
                                    type="button" 
                                    id="load-tracking-btn" 
                                    class="btn btn--primary"
                                    disabled
                                >
                                    <span class="btn__text">Load Tracking</span>
                                    <span class="btn__loader" aria-hidden="true"></span>
                                </button>
                            </div>
                            <div id="chat-id-help" class="form-help">
                                Enter your Telegram Chat ID to view your flight tracking requests.
                                <a href="https://t.me/userinfobot" target="_blank" rel="noopener noreferrer">
                                    Don't know your Chat ID?
                                </a>
                            </div>
                            <div id="chat-id-error" class="form-error" role="alert" aria-live="polite"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- System Messages -->
            <div id="system-messages" class="messages" role="alert" aria-live="polite" aria-atomic="true">
                <!-- Success/Error messages will be inserted here -->
            </div>

            <!-- Tracking Overview -->
            <section id="tracking-overview" class="tracking-overview hidden" role="region" aria-labelledby="overview-title">
                <h3 id="overview-title" class="section-title">Tracking Overview</h3>
                <div class="overview-grid">
                    <div class="stat-card stat-card--active">
                        <div class="stat-card__icon" aria-hidden="true">üü¢</div>
                        <div class="stat-card__content">
                            <div class="stat-card__value" id="active-count">0</div>
                            <div class="stat-card__label">Active Tracking</div>
                        </div>
                    </div>
                    <div class="stat-card stat-card--expired">
                        <div class="stat-card__icon" aria-hidden="true">‚è∞</div>
                        <div class="stat-card__content">
                            <div class="stat-card__value" id="expired-count">0</div>
                            <div class="stat-card__label">Expired</div>
                        </div>
                    </div>
                    <div class="stat-card stat-card--alerts">
                        <div class="stat-card__icon" aria-hidden="true">üîî</div>
                        <div class="stat-card__content">
                            <div class="stat-card__value" id="alerts-count">0</div>
                            <div class="stat-card__label">Total Alerts</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Filters and Controls -->
            <section id="tracking-controls" class="tracking-controls hidden" role="region" aria-labelledby="controls-title">
                <h3 id="controls-title" class="sr-only">Tracking Controls</h3>
                <div class="controls-bar">
                    <div class="filter-group">
                        <label for="status-filter" class="filter-label">Filter by Status:</label>
                        <select id="status-filter" class="filter-select">
                            <option value="all">All Requests</option>
                            <option value="active" selected>Active Only</option>
                            <option value="expired">Expired Only</option>
                        </select>
                    </div>
                    <div class="sort-group">
                        <label for="sort-select" class="filter-label">Sort by:</label>
                        <select id="sort-select" class="filter-select">
                            <option value="created_desc">Newest First</option>
                            <option value="created_asc">Oldest First</option>
                            <option value="departure_asc">Departure Date</option>
                            <option value="price_desc">Lowest Price</option>
                        </select>
                    </div>
                    <button type="button" id="refresh-btn" class="btn btn--secondary">
                        <span class="btn__icon" aria-hidden="true">üîÑ</span>
                        Refresh
                    </button>
                </div>
            </section>

            <!-- Tracking Requests List -->
            <section id="tracking-list" class="tracking-list hidden" role="region" aria-labelledby="list-title">
                <h3 id="list-title" class="section-title">Your Tracking Requests</h3>
                <div id="tracking-requests" class="requests-grid">
                    <!-- Tracking request cards will be inserted here -->
                </div>
                
                <!-- Empty State -->
                <div id="empty-state" class="empty-state hidden">
                    <div class="empty-state__icon" aria-hidden="true">üì≠</div>
                    <h4 class="empty-state__title">No Tracking Requests Found</h4>
                    <p class="empty-state__description">
                        You don't have any flight tracking requests yet.
                    </p>
                    <a href="index.html" class="btn btn--primary">Create Your First Track</a>
                </div>

                <!-- Loading State -->
                <div id="loading-state" class="loading-state">
                    <div class="loader" aria-hidden="true"></div>
                    <div class="loading-text">Loading your tracking requests...</div>
                </div>
            </section>
        </div>
    </main>

    <!-- Price History Modal -->
    <div id="price-history-modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal__overlay" role="presentation"></div>
        <div class="modal__content">
            <div class="modal__header">
                <h4 id="modal-title" class="modal__title">Price History</h4>
                <button type="button" class="modal__close" aria-label="Close modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal__body">
                <div id="price-chart-container" class="chart-container">
                    <canvas id="price-chart" aria-label="Price history chart"></canvas>
                </div>
                <div id="price-stats" class="price-stats">
                    <!-- Price statistics will be inserted here -->
                </div>
            </div>
            <div class="modal__footer">
                <button type="button" class="btn btn--secondary modal-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal" role="dialog" aria-labelledby="delete-title" aria-hidden="true">
        <div class="modal__overlay" role="presentation"></div>
        <div class="modal__content modal__content--small">
            <div class="modal__header">
                <h4 id="delete-title" class="modal__title">Delete Tracking Request</h4>
            </div>
            <div class="modal__body">
                <p>Are you sure you want to delete this tracking request? This action cannot be undone.</p>
                <div id="delete-request-details" class="delete-details">
                    <!-- Request details will be inserted here -->
                </div>
            </div>
            <div class="modal__footer">
                <button type="button" class="btn btn--secondary modal-close">Cancel</button>
                <button type="button" id="confirm-delete-btn" class="btn btn--danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer__content">
                <p class="footer__text">
                    &copy; 2024 Flight Price Tracker. Built with ‚ù§Ô∏è for travelers.
                </p>
                <div class="footer__links">
                    <a href="#" class="footer__link">Privacy Policy</a>
                    <a href="#" class="footer__link">Terms of Service</a>
                    <a href="#" class="footer__link">Support</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Templates -->
    <template id="tracking-card-template">
        <div class="tracking-card" data-request-id="">
            <div class="tracking-card__header">
                <div class="tracking-card__route">
                    <span class="route-airports">
                        <span class="airport-code origin"></span>
                        <span class="route-arrow" aria-hidden="true">‚Üí</span>
                        <span class="airport-code destination"></span>
                    </span>
                    <div class="route-type"></div>
                </div>
                <div class="tracking-card__status">
                    <span class="status-badge"></span>
                </div>
            </div>
            
            <div class="tracking-card__details">
                <div class="detail-row">
                    <span class="detail-label">Departure:</span>
                    <span class="detail-value departure-date"></span>
                </div>
                <div class="detail-row return-date-row">
                    <span class="detail-label">Return:</span>
                    <span class="detail-value return-date"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Passengers:</span>
                    <span class="detail-value passengers"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Class:</span>
                    <span class="detail-value cabin-class"></span>
                </div>
                <div class="detail-row max-price-row">
                    <span class="detail-label">Max Price:</span>
                    <span class="detail-value max-price"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Expires:</span>
                    <span class="detail-value expires-at"></span>
                </div>
            </div>

            <div class="tracking-card__price">
                <div class="current-price">
                    <div class="price-label">Current Best Price</div>
                    <div class="price-value">
                        <span class="price-amount">--</span>
                        <span class="price-trend"></span>
                    </div>
                    <div class="price-updated">Last updated: <span class="update-time">--</span></div>
                </div>
            </div>

            <div class="tracking-card__actions">
                <button type="button" class="btn btn--small btn--secondary view-history-btn">
                    <span class="btn__icon" aria-hidden="true">üìä</span>
                    Price History
                </button>
                <button type="button" class="btn btn--small btn--danger delete-btn">
                    <span class="btn__icon" aria-hidden="true">üóëÔ∏è</span>
                    Delete
                </button>
            </div>
        </div>
    </template>

    <!-- Scripts -->
    <script src="scripts/tracking.js" defer></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .catch(() => {
                    // Service worker registration failed, but app should still work
                });
        }
    </script>
</body>
</html>